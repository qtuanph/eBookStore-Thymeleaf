<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω m√£ gi·∫£m gi√° - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/admin_style.css}">
</head>
<body class="bg-light">

<div class="wrapper">
    <div th:replace="~{fragments/admin_sidebar :: sidebar}"></div>
    <div id="content" class="container-fluid p-4">

        <!-- Th√¥ng b√°o -->
        <div th:if="${param.success}" class="alert alert-success mb-2">
            <span th:if="${param.success == 'created'}">T·∫°o m√£ gi·∫£m gi√° th√†nh c√¥ng!</span>
            <span th:if="${param.success == 'updated'}">C·∫≠p nh·∫≠t m√£ gi·∫£m gi√° th√†nh c√¥ng!</span>
            <span th:if="${param.success == 'deleted'}">X√≥a m√£ gi·∫£m gi√° th√†nh c√¥ng!</span>
        </div>
        <div th:if="${param.error}" class="alert alert-danger mb-2">
            <span th:if="${param.error == 'not-found'}">Kh√¥ng t√¨m th·∫•y m√£ gi·∫£m gi√° c·∫ßn s·ª≠a ho·∫∑c x√≥a!</span>
            <span th:unless="${param.error == 'not-found'}" th:text="${param.error}"></span>
        </div>

        <!-- Topbar -->
        <div class="d-flex justify-content-between mb-4">
            <div>
                <h2 class="text-primary mb-0">üé´ Qu·∫£n l√Ω m√£ gi·∫£m gi√°</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}">Dashboard</a></li>
                        <li class="breadcrumb-item active">M√£ gi·∫£m gi√°</li>
                    </ol>
                </nav>
            </div>
            <div>
                <span th:text="${#authentication.name}"></span>
                <form th:action="@{/logout}" method="post" class="d-inline">
                    <button class="btn btn-outline-danger" type="submit">
                        <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
                    </button>
                </form>
            </div>
        </div>

        <!-- Search & Filter -->
        <form class="row g-3 mb-3" th:action="@{/admin/discounts}" method="get">
            <div class="col-md-4">
                <input class="form-control" name="search" placeholder="T√¨m theo m√£, m√¥ t·∫£..."
                       th:value="${param.search}">
            </div>
            <div class="col-md-3">
                <select name="type" class="form-select">
                    <option value="">T·∫•t c·∫£ lo·∫°i</option>
                    <option value="PERCENTAGE" th:selected="${param.type == 'PERCENTAGE'}">Gi·∫£m theo %</option>
                    <option value="FIXED_AMOUNT" th:selected="${param.type == 'FIXED_AMOUNT'}">Gi·∫£m c·ªë ƒë·ªãnh</option>
                </select>
            </div>
            <div class="col-md-3">
                <select name="status" class="form-select">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="active" th:selected="${param.status == 'active'}">Ho·∫°t ƒë·ªông</option>
                    <option value="expired" th:selected="${param.status == 'expired'}">ƒê√£ h·∫øt h·∫°n</option>
                    <option value="inactive" th:selected="${param.status == 'inactive'}">Kh√¥ng ho·∫°t ƒë·ªông</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100" type="submit">
                    <i class="fas fa-filter"></i> L·ªçc
                </button>
            </div>
        </form>

        <!-- Th√™m m·ªõi -->
        <div class="mb-3 text-end">
            <a class="btn btn-success" th:href="@{/admin/discounts/create}">
                <i class="fas fa-plus"></i> Th√™m m√£ gi·∫£m gi√°
            </a>
        </div>

        <!-- Danh s√°ch -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle bg-white">
                <thead class="table-light text-center">
                <tr>
                    <th>ID</th>
                    <th>M√£</th>
                    <th>M√¥ t·∫£</th>
                    <th>Lo·∫°i</th>
                    <th>Gi√° tr·ªã</th>
                    <th>ƒê∆°n t·ªëi thi·ªÉu</th>
                    <th>Gi·∫£m t·ªëi ƒëa</th>
                    <th>Th·ªùi gian</th>
                    <th>Gi·ªõi h·∫°n</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="coupon : ${coupons}" class="text-center">
                    <td th:text="${coupon.id}"></td>
                    <td><span class="badge bg-secondary" th:text="${coupon.code}"></span></td>
                    <td th:text="${coupon.description}"></td>
                    <td>
                        <span th:if="${coupon.discountType == 'PERCENTAGE'}" class="badge bg-info">Gi·∫£m theo %</span>
                        <span th:if="${coupon.discountType != 'PERCENTAGE'}" class="badge bg-warning">Gi·∫£m c·ªë ƒë·ªãnh</span>
                    </td>
                    <td>
                        <span th:if="${coupon.discountType == 'PERCENTAGE'}" th:text="${coupon.discountValue + '%'}"></span>
                        <span th:if="${coupon.discountType != 'PERCENTAGE'}" th:text="${#numbers.formatDecimal(coupon.discountValue, 0, 0) + ' VNƒê'}"></span>
                    </td>
                    <td th:text="${#numbers.formatDecimal(coupon.minPurchase, 0, 0) + ' VNƒê'}"></td>
                    <td th:text="${coupon.maxDiscount != null ? #numbers.formatDecimal(coupon.maxDiscount, 0, 0) + ' VNƒê' : '-'}"></td>
                    <td>
                        <small th:text="${#dates.format(coupon.startDate, 'dd/MM/yyyy')} + ' - ' + ${#dates.format(coupon.endDate, 'dd/MM/yyyy')}"></small>
                    </td>
                    <td th:text="${coupon.usageLimit != null ? coupon.usageLimit : '-'}"></td>
                    <td>
                        <span th:if="${coupon.isActive}" class="badge bg-success">Ho·∫°t ƒë·ªông</span>
                        <span th:if="${!coupon.isActive}" class="badge bg-secondary">Kh√¥ng ho·∫°t ƒë·ªông</span>
                    </td>
                    <td>
                        <a class="btn btn-sm btn-primary" th:href="@{'/admin/discounts/edit/' + ${coupon.id}}">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a class="btn btn-sm btn-danger" th:href="@{'/admin/discounts/delete/' + ${coupon.id}}"
                           onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?');">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav th:if="${coupons.totalPages > 1}" class="mt-3">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${coupons.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/admin/discounts(page=${coupons.number - 1})}">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(0, coupons.totalPages - 1)}"
                    th:classappend="${i == coupons.number} ? 'active'">
                    <a class="page-link" th:href="@{/admin/discounts(page=${i})}" th:text="${i + 1}"></a>
                </li>
                <li class="page-item" th:classappend="${coupons.last} ? 'disabled'">
                    <a class="page-link" th:href="@{/admin/coupons(page=${coupons.number + 1})}">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/script_admin_discounts.js}"></script>
</body>
</html>
